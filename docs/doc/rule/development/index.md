---
outline: deep
---

# api 规范

改目录下包含请求方式、接口入参、返回数据等内容。

## 1、请求方式

统一请求方式，增、删、改、查尽量统一使用 post 请求，下载文件使用 get 请求，post 请求 header 设置 Content-Type 使用以下两种

::: tip Content-Type:
"application/json" 正常传参

"multipart/form-data" 文件上传
:::

::: warning 警告
post 请求避免使用"application/x-www-form-urlencoded"请求头
:::

## 2、请求入参

### 2.1 入参符合小驼峰命名法

后端定义前端传输字段（入参）要符合驼峰命名如：storeName；见名知意；后台返回字段（出参）也需符合驼峰命名，入参和出参字段命名须保持一致。

### 2.2 入参文字说明

请求参数（入参）所有字段必须标明参数说明、数据类型、是否必传，不要出现无用参数，容易误导前端开发者。

| 参数名称   | 参数说明                                                     | 数据类型 | 是否必传 |
| ---------- | ------------------------------------------------------------ | -------- | -------- |
| dateList   | 月份列表                                                     | array    | false    |
| mainPeriod | 时间统计维度： 2：季度，3：月，7：日，8：旬                  | integer  | true     |
| month      | 月份(实例：2023-01)                                          | string   | false    |
| userType   | 用户类型：1：普通用户，2：战新用户，3：低压用户，4：全体用户 | string   | true     |

### 2.3 枚举类型说明

接口传值中涉及到需要枚举值的地方，是否可以考虑维护一个统一可扩展维护的字典，在 api 文档相应位置做出展示说明，保证统一性，方便 api 调用者查阅使用（枚举如果使用数字，尽量避免使用 0，因为使用 0 前端判断时可能出现漏判或者误判）。

### 2.4 分页字典和排序字段说明

接口中涉及查询列表的地方，分页参数配置保持统一固定的传参方式，目前根据后端定义的分页参数示例

| 参数名称    | pageParam                 |
| ----------- | ------------------------- |
| currentPage | 当前页码                  |
| pageSize    | 每页大小                  |
| orderType   | 1、顺序-ASC，2、倒序-DESC |
| sortName    | 排序字段                  |

### 2.5 时间字段说明

涉及到时间类型的传参根据目前的开发习惯固定为格式化的传递方式，如日期：“2023-01-01”，月份：“2023-01”，年份：“2023”，涉及传递时间段的参数统一规定传数组,[“2023-02-01”, “2023-02-20”]

### 2.6 删除接口说明

涉及到列表的删除接口，为了保持风格统一，希望全部支持批量删除，请求方式统一为 post，传参形式为数组[1,2,3…]。

## 3、返回数据

### 3.1 顶层结构

后台返回数据字段需都在 data 里，不得在 data 之外，data 必须是一个对象，即使里面 data 只有一类数据

### 3.2 数据结构

后台返回值为空时，需返回相对应的键名如：{listData: null} ，键值为空时值为 null，如果返回参数是多层对象嵌套，在数据为空时需要保证返回结构完整。（需要特殊处理的是图表数据如果为空时，需要返回完整的数据结构，例如价格数据为空，x 轴数据是[“00:15”, “00:30”, …]，那么价格数据对应的 list 数组需要返回[null,null,…]，特别说明：null 和 0 是两种情况)。

### 3.3 返回参数说明

返回参数（响应参数）需要做出适当的参数说明，这样可以规避在返回参数较多的情况下前端调用者理解错误参数用意导致页面数据渲染出现偏差。

### 3.4 表格数据和图表数据

表格（table）数据应该返回一个 list 数组,数组包含 n 个对象，一个对象表示一行数据（实际大多数应用场景下表格数据都是以行为单位来处理的），涉及到页面有图表和表格切换，如果后端方便可同时返回图表和表格数据，如果嫌麻烦可返回完整的表格数据，前端根据表格数据封装图表数据。

### 3.5 特殊参数说明

#### 3.5.1 级联选择器传值

前端传值使用数组（尽量使用 post 请求，如为 get 请求则以字符串拼接方式进行传值，例如：”1,3”），回显方式为两种：

（1）可编辑页面后端返回的值必须是数组；

（2）详情页面在返回对应值的数组的同时还需返回对应的 name，方便展示

#### 3.5.2 switch 开关传值

涉及到 switch 开关控制器的 value 值希望能统一，0/1、true/false 二选一使用一种即可，形成一种默契。使用 0/1 时需要统一风格，即 0 表示关闭，1 表示打开。

### 3.6 文件下载说明

所有的下载文件接口文件名均由后台进行返回，后台开发人员将文件名添加在返回体 header 中的 Content-disposition 参数中，具体值的格式为：attachment; filename=fileName，并且需要配置 Access-Control-Expose-Headers 参数的值为：Content-Disposition，暴露相应参数以便前端开发人员可以取到文件名，注意需要对文件名进行 utf-8 编码，防止文件名出现乱码;

::: tip 后端具体配置代码如下：

对文件名进行编码，防止出现乱码

String fileName = URLEncoder.encode(fileName,"utf-8");

添加文件名

response.setHeader("Content-Disposition", "attachment; filename=fileName");

暴露 Content-Disposition 参数给前端，用于获取文件名

response.setHeader("Access-Control-Expose-Headers", "Content-Disposition");
:::

前端代码处理

```javascript
if (response.headers["Content-Disposition"]) {
  let str = response.headers["Content-Disposition"];
  str = str.substring(str.indexOf("=") + 1, str.length);
  data.fileName = decodeURI(str);
}
```
